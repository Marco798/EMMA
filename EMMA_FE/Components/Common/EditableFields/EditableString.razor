@using EMMA.Commons.UpdateSingleField

@inject HttpClient Http
@inject IJSRuntime JS
@inherits EMMA_FE.Classes.Common.EditableFields<string>

@rendermode InteractiveServer

<head>
    <link href="css/Common/EditableFields.css" rel="stylesheet" />
</head>

@if (Editing) {
    <div class="EditDiv">
        <input type="text" @ref=element @bind-value="Value" @onkeydown=OnKeyDown>
        <input type="button" value="S" title="Save" class="EditButton Save" @onclick="Save">
        <input type="button" value="R" title="Reset" class="EditButton Reset" @onclick="() => {Value = originalValue;}">
        <input type="button" value="C" title="Cancel" class="EditButton Cancel" @onclick="Cancel">
    </div>
}
else {
    <div class="ReadDiv">
        <span>@Value</span>
        <input type="button" class="ReadButton"
               @onclick="ActiveEditing"
               @bind=EditButton
               @onmouseover='() => {EditButton = "Edit";}'
               @onmouseout='() => {EditButton = string.Empty;}' />
    </div>
}

@code {
    protected override async Task Save() {
        UpdateStringFieldData updateStringFieldData = new UpdateStringFieldData(TableName, FieldName, Value, Id);
        var response = await Http.PostAsJsonAsync(@"https://localhost:7062/UpdateSingleField/UpdateStringField", updateStringFieldData);
        if (response.IsSuccessStatusCode) {
            Editing = false;
            EditButton = string.Empty;
        }
    }
}
